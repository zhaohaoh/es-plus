/* empty css               *//* empty css               *//* empty css                     *//* empty css                *//* empty css              *//* empty css               */import{d as ie,r,o as pe,a as ce,b as me,c as ye,Q as fe,N as ve,e as _e,a9 as ge,aa as be,P as xe,f as m,i as x,R as b,F as C,j as F,h as l,w as a,p as v,u as w,T as he,U as Ee,g as D,a2 as Ce,S as $,E as we,v as Ve,a8 as Be,L as ke,a1 as Fe,k as De,a7 as Te,_ as je}from"./index.3900749f.js";import{e as Se}from"./message.198e849d.js";import{J as R}from"./index.3bafade1.js";const Ne={class:"searchForm",style:{"max-height":"200px","margin-left":"-15px"}},Oe={class:"container",style:{"margin-left":"-20px","margin-top":"10px"}},Ue={class:"buju"},Ae=["onClick"],Ie={class:"right-container",style:{"margin-top":"-20px"}},Ke={class:"right-container"},Je={class:"downIndex"},Me=ie({__name:"esTable",setup(Le){let V=r(!1),B=r(!1);const U=r(""),k=r("json"),A=r("{}");let _=r("");const W=()=>{k.value=k.value==="json"?"table":"json",console.log("\u8868\u683C\u63A7\u5236\u503C"+k.value)},z=()=>{localStorage.setItem("indexKeyword",_.value),L(_.value)},T=r([{mustType:"must",field:"",searchType:"terms",searchKeyword:"",sortName:"_id",sort:"DESC"}]),h=r({sortName:"_id",sort:"DESC"}),X=()=>{T.value.push({mustType:"must",field:"",searchType:"terms",searchKeyword:"",sortName:"",sort:""})},Z=o=>{T.value.splice(o,1)},I=r([]),K=r(""),P=r([]),J=r();let M=r();const Y=r([]),{proxy:j}=De(),ee=async(o,e,s,d)=>{const n=d.target.innerText;le(n)};function le(o){const e=document.createElement("textarea");e.value=o,document.body.appendChild(e),e.select();try{const s=document.execCommand("copy")}catch(s){console.error("\u964D\u7EA7\u590D\u5236\u51FA\u9519:",s),alert(`\u81EA\u52A8\u590D\u5236\u5931\u8D25\uFF0C\u8BF7\u6309 Ctrl+C \u624B\u52A8\u590D\u5236\uFF1A
`+o)}document.body.removeChild(e)}const q=async o=>{B.value=!0},te=async()=>{const o={index:y.value,datas:[JSON.parse(A.value)]};console.log("baocun :"+JSON.stringify(o)),await j.$api.tools.updateBatch(o),Se.success()},ae=async o=>{await oe(o),V.value=!0,y.value=o},oe=async o=>{const e={indexName:o};let s=await j.$api.esIndex.getMapping(e);U.value=JSON.stringify(s,null,2)},y=r(),ue=o=>{y.value=o,J.value=P.value[y.value],M.value=Object.keys(J.value),H()},L=async o=>{const e={keyword:o};let s=await j.$api.esIndex.indexList(e);P.value=s.flatMappings,Y.value=s.indices};let S=[];const se=r("Es.chainQuery()");pe(()=>{const o=localStorage.getItem("indexKeyword");o!=null?(_.value=o,L(_.value)):L("")});const H=()=>{if(!y.value||y.value==null){we("\u8BF7\u9009\u62E9\u7D22\u5F15");return}ne()},ne=async()=>{let o=se.value+'.index("'+y.value+'")';T.value.forEach(e=>{if(e&&e.searchType&&e.field&&e.searchKeyword){const s=e.mustType;o+="."+s+"()";let d=e.searchKeyword;e.field=="_id"&&(d='"'+e.searchKeyword+'"'),Object.entries(J.value).forEach(([n,u])=>{n==e.field&&(u=="text"||u=="keyword")&&(d='"'+e.searchKeyword+'"'),n==e.field&&u=="long"&&(d=e.searchKeyword+"L")}),o+="."+e.searchType+'("'+e.field+'",'+d+")"}}),o=o+'.sortBy("'+h.value.sort+'","'+h.value.sortName+'")',o+=".search(10)",console.log(o),re(o)},re=async o=>{const e={epl:o},d=(await j.$api.tools.eplQuery(e)).hits.hits;d.forEach(u=>u._source._id=u._id);const n=d.map(u=>u._source);if(n!=null&&n.length>0){let u,i=0;for(const p of n){const g=Object.keys(p);g.length>i&&(i=g.length,u=g)}u.push("_id");const f=Object.entries(n[0]),E=[];f.forEach(([p,g])=>{g!=null&&g!==""&&E.push(p)}),u=u.filter(p=>!E.includes(p)),u.unshift(...E);const N=u.indexOf("id");if(N>-1){const[p]=u.splice(N,1);u.unshift(p)}const O=u.indexOf("_id");if(O>-1){const[p]=u.splice(O,1);u.unshift(p)}S.length=0,u.forEach(p=>{S.push({prop:p,label:p})}),console.log("\u8868\u5934"+u),console.log("\u8868\u5934:::"+JSON.stringify(S))}for(const u of n)Object.entries(u).forEach(([i,f])=>{de(f)&&(u[i]=JSON.stringify(f))});I.value=n,K.value=JSON.stringify(n,null,2)};function de(o){const e=Object.prototype.toString.call(o);return e==="[object Object]"||e==="[object Array]"}return(o,e)=>{const s=ce,d=me,n=ye,u=fe,i=ve,f=_e,E=ge,N=Ve,O=Te,p=Be,g=be,G=xe;return m(),x(C,null,[b("div",Ne,[(m(!0),x(C,null,F(T.value,(t,Q)=>(m(),D(f,{key:Q,style:{width:"100%","margin-bottom":"5px"},class:"custom-margin"},{default:a(()=>[l(n,{span:3},{default:a(()=>[l(d,{modelValue:t.mustType,"onUpdate:modelValue":c=>t.mustType=c,placeholder:"\u8BF7\u9009\u62E9"},{default:a(()=>[l(s,{label:"must",value:"must"}),l(s,{label:"should",value:"should"}),l(s,{label:"mustNot",value:"mustNot"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(n,{span:3},{default:a(()=>[l(d,{filterable:"",modelValue:t.field,"onUpdate:modelValue":c=>t.field=c,placeholder:"\u8BF7\u9009\u62E9\u5B57\u6BB5"},{default:a(()=>[l(s,{key:"_id",label:"_id",value:"_id"}),(m(!0),x(C,null,F(w(M),c=>(m(),D(s,{key:c,label:c,value:c},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(n,{span:3},{default:a(()=>[l(d,{modelValue:t.searchType,"onUpdate:modelValue":c=>t.searchType=c,placeholder:"\u8BF7\u9009\u62E9"},{default:a(()=>[l(s,{label:"terms",value:"terms"}),l(s,{label:"match",value:"match"}),l(s,{label:"wildcard",value:"wildcard"}),l(s,{label:"lt",value:"lt"}),l(s,{label:"le",value:"le"}),l(s,{label:"gt",value:"gt"}),l(s,{label:"ge",value:"ge"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(n,{span:3},{default:a(()=>[l(u,{modelValue:t.searchKeyword,"onUpdate:modelValue":c=>t.searchKeyword=c,clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(n,{span:8},{default:a(()=>[l(i,{onClick:X,type:"primary"},{default:a(()=>e[10]||(e[10]=[v("+")])),_:1}),l(i,{onClick:c=>Z(Q),type:"danger"},{default:a(()=>e[11]||(e[11]=[v("-")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),l(f,{style:{display:"flex","justify-content":"end","margin-top":"-0px","margin-right":"40px","flex-direction":"row"}},{default:a(()=>[l(n,{span:2},{default:a(()=>[l(i,{type:"primary",plain:"",onClick:W},{default:a(()=>e[12]||(e[12]=[v("JSON/\u8868\u683C")])),_:1})]),_:1}),l(n,{span:3},{default:a(()=>[l(d,{filterable:"",modelValue:h.value.sortName,"onUpdate:modelValue":e[0]||(e[0]=t=>h.value.sortName=t),placeholder:"\u8BF7\u9009\u62E9\u5B57\u6BB5"},{default:a(()=>[(m(!0),x(C,null,F(w(M),t=>(m(),D(s,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(n,{span:2},{default:a(()=>[l(d,{modelValue:h.value.sort,"onUpdate:modelValue":e[1]||(e[1]=t=>h.value.sort=t),placeholder:"\u8BF7\u9009\u62E9"},{default:a(()=>[l(s,{label:"DESC",value:"DESC"}),l(s,{label:"ASC",value:"ASC"})]),_:1},8,["modelValue"])]),_:1}),l(i,{onClick:H,plain:"",type:"primary"},{default:a(()=>e[13]||(e[13]=[v(" \u67E5\u8BE2 ")])),_:1})]),_:1})]),b("div",Oe,[b("div",Ue,[l(N,{width:"250px"},{default:a(()=>[l(E,null,{default:a(()=>[(m(!0),x(C,null,F(Y.value,t=>(m(),x("p",{key:t,class:"scrollbar-demo-item",onClick:Q=>ue(t),style:ke({background:y.value===t?"#84BEFC":"var(--el-color-primary-light-9)"})},Fe(t),13,Ae))),128))]),_:1})]),_:1}),he(b("div",Ie,[l(f,{gutter:10},{default:a(()=>[l(p,{onCellDblclick:ee,data:I.value,style:{"max-width":"1200px","max-height":"1000px","min-height":"100px"},size:"large"},{default:a(()=>[(m(!0),x(C,null,F(w(S),t=>(m(),D(O,{key:t.prop,label:t.label,prop:t.prop,width:"180"},null,8,["label","prop"]))),128))]),_:1},8,["data"])]),_:1}),l(f,{class:"row-bg",justify:"end"},{default:a(()=>[l(n,{span:1},{default:a(()=>[l(i,{type:"primary",plain:"",onClick:q},{default:a(()=>e[14]||(e[14]=[v("\u65B0\u589E")])),_:1})]),_:1})]),_:1})],512),[[Ee,I.value.length>0&&k.value=="table"]]),k.value=="json"?(m(),D(g,{key:0,class:"box-card"},{default:a(()=>[b("div",Ke,[l(R,{value:K.value,"onUpdate:value":e[2]||(e[2]=t=>K.value=t),height:"600",width:"800",styles:"width: 100%",title:""},null,8,["value"]),l(f,{class:"row-bg",justify:"end"},{default:a(()=>[l(n,{span:1},{default:a(()=>[l(i,{type:"primary",plain:"",onClick:q},{default:a(()=>e[15]||(e[15]=[v("\u65B0\u589E")])),_:1})]),_:1})]),_:1})])]),_:1})):Ce("",!0)])]),b("div",Je,[l(u,{modelValue:w(_),"onUpdate:modelValue":e[3]||(e[3]=t=>$(_)?_.value=t:_=t),placeholder:"\u8BF7\u8F93\u5165\u7D22\u5F15\u540D\u79F0",style:{width:"240px","margin-top":"0px","margin-left":"-15px"},onChange:z},null,8,["modelValue"]),l(i,{type:"primary",onClick:e[4]||(e[4]=t=>z()),plain:"",style:{width:"240px","margin-top":"10px","margin-left":"-15px"}},{default:a(()=>e[16]||(e[16]=[v("\u67E5\u8BE2\u8FC7\u6EE4")])),_:1}),l(i,{type:"primary",onClick:e[5]||(e[5]=t=>ae(y.value)),plain:"",style:{width:"240px","margin-top":"10px","margin-left":"-15px"}},{default:a(()=>e[17]||(e[17]=[v("\u67E5\u770B\u6620\u5C04")])),_:1})]),l(G,{modelValue:w(V),"onUpdate:modelValue":e[7]||(e[7]=t=>$(V)?V.value=t:V=t),title:"\u67E5\u770B\u6620\u5C04",style:{"max-width":"700px",position:"relative",height:"750px",transform:"translateY(-50px)"}},{default:a(()=>[b("div",null,[l(R,{value:U.value,"onUpdate:value":e[6]||(e[6]=t=>U.value=t),height:"600",styles:"width: 100%",title:"\u67E5\u770B\u6620\u5C04"},null,8,["value"])])]),_:1},8,["modelValue"]),l(G,{modelValue:w(B),"onUpdate:modelValue":e[9]||(e[9]=t=>$(B)?B.value=t:B=t),title:"\u5F53\u524D\u7D22\u5F15:"+y.value,style:{"max-width":"700px",position:"relative",height:"750px",transform:"translateY(-50px)"}},{default:a(()=>[b("div",null,[l(R,{value:A.value,"onUpdate:value":e[8]||(e[8]=t=>A.value=t),height:"600",styles:"width: 100%",title:"\u65B0\u589E\u6570\u636E\u6CE8\u610F:_id\u5FC5\u586B,\u5426\u5219\u4F1A\u81EA\u52A8\u751F\u6210id"},null,8,["value"])]),l(i,{type:"primary",onClick:te,style:{position:"absolute",right:"10px",bottom:"10px"}},{default:a(()=>e[18]||(e[18]=[v(" \u4FDD\u5B58\u6570\u636E ")])),_:1})]),_:1},8,["modelValue","title"])],64)}}});const We=je(Me,[["__scopeId","data-v-e33bbba0"]]);export{We as default};
