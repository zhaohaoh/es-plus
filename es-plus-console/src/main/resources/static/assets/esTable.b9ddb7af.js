/* empty css               *//* empty css               *//* empty css                     *//* empty css                *//* empty css              *//* empty css               */import{d as ce,r,o as me,b as ve,e as ye,a as fe,M as _e,K as ge,f as be,a3 as xe,a7 as he,O as Ee,N as Ce,g as m,l as h,j as f,F,m as j,i as l,w as a,k as _,u as V,Q as we,R as Fe,h as T,I as Ve,P as R,E as Be,z as ke,a1 as De,J as je,t as Te,n as Oe,a0 as Se,_ as Ne}from"./index.9b200e75.js";import{e as Ie}from"./message.a8491c03.js";import{J as z}from"./index.fccd0cd9.js";const Ue={class:"searchForm",style:{"max-height":"200px","margin-left":"-15px"}},Ae={class:"container",style:{"margin-left":"-20px","margin-top":"10px"}},Ke={class:"buju"},Je=["onClick"],Me={class:"right-container",style:{"margin-top":"-20px"}},Le={class:"right-container"},Qe={class:"downIndex"},$e={style:{"margin-bottom":"10px"}},Re=ce({__name:"esTable",setup(ze){let B=r(!1),E=r(!1);const A=r(""),k=r("json"),D=r("{}"),x=r("");let g=r("");const X=()=>{k.value=k.value==="json"?"table":"json",console.log("\u8868\u683C\u63A7\u5236\u503C"+k.value)},P=()=>{localStorage.setItem("indexKeyword",g.value),Q(g.value)},O=r([{mustType:"must",field:"",searchType:"terms",searchKeyword:"",sortName:"_id",sort:"DESC"}]),C=r({sortName:"_id",sort:"DESC"}),Z=()=>{O.value.push({mustType:"must",field:"",searchType:"terms",searchKeyword:"",sortName:"",sort:""})},ee=u=>{O.value.splice(u,1)},K=r([]),J=r(""),Y=r([]),M=r();let L=r();const q=r([]),{proxy:S}=Oe(),le=async(u,e,s,d)=>{const n=d.target.innerText;te(n)};function te(u){const e=document.createElement("textarea");e.value=u,document.body.appendChild(e),e.select();try{const s=document.execCommand("copy")}catch(s){console.error("\u964D\u7EA7\u590D\u5236\u51FA\u9519:",s),alert(`\u81EA\u52A8\u590D\u5236\u5931\u8D25\uFF0C\u8BF7\u6309 Ctrl+C \u624B\u52A8\u590D\u5236\uFF1A
`+u)}document.body.removeChild(e)}const H=async u=>{x.value="",D.value="{}",E.value=!0},ae=async()=>{const u=JSON.parse(D.value);x.value&&x.value.trim()!==""&&(u._routing=x.value.trim());const e={index:v.value,datas:[u]};console.log("\u4FDD\u5B58: "+JSON.stringify(e)),await S.$api.tools.updateBatch(e),Ie.success(),E.value=!1,x.value="",D.value="{}"},ue=async u=>{await oe(u),B.value=!0,v.value=u},oe=async u=>{const e={indexName:u};let s=await S.$api.esIndex.getMapping(e);A.value=JSON.stringify(s,null,2)},v=r(),se=u=>{v.value=u,M.value=Y.value[v.value],L.value=Object.keys(M.value),G()},Q=async u=>{const e={keyword:u};let s=await S.$api.esIndex.indexList(e);Y.value=s.flatMappings,q.value=s.indices};let N=[];const ne=r("Es.chainQuery()");me(()=>{const u=localStorage.getItem("indexKeyword");u!=null?(g.value=u,Q(g.value)):Q("")});const G=()=>{if(!v.value||v.value==null){Be("\u8BF7\u9009\u62E9\u7D22\u5F15");return}re()},re=async()=>{let u=ne.value+'.index("'+v.value+'")';O.value.forEach(e=>{if(e&&e.searchType&&e.field&&e.searchKeyword){const s=e.mustType;u+="."+s+"()";let d=e.searchKeyword;e.field=="_id"&&(d='"'+e.searchKeyword+'"'),Object.entries(M.value).forEach(([n,o])=>{n==e.field&&(o=="text"||o=="keyword")&&(d='"'+e.searchKeyword+'"'),n==e.field&&o=="long"&&(d=e.searchKeyword+"L")}),u+="."+e.searchType+'("'+e.field+'",'+d+")"}}),u=u+'.sortBy("'+C.value.sort+'","'+C.value.sortName+'")',u+=".search(10)",console.log(u),de(u)},de=async u=>{const e={epl:u},d=(await S.$api.tools.eplQuery(e)).hits.hits;d.forEach(o=>{o._source._id=o._id,o._source._routing=o._routing||""});const n=d.map(o=>o._source);if(n!=null&&n.length>0){let o,i=0;for(const p of n){const b=Object.keys(p);b.length>i&&(i=b.length,o=b)}o.push("_id");const y=Object.entries(n[0]),w=[];y.forEach(([p,b])=>{b!=null&&b!==""&&w.push(p)}),o=o.filter(p=>!w.includes(p)),o.unshift(...w);const I=o.indexOf("id");if(I>-1){const[p]=o.splice(I,1);o.unshift(p)}const U=o.indexOf("_id");if(U>-1){const[p]=o.splice(U,1);o.unshift(p)}N.length=0,o.forEach(p=>{N.push({prop:p,label:p})}),console.log("\u8868\u5934"+o),console.log("\u8868\u5934:::"+JSON.stringify(N))}for(const o of n)Object.entries(o).forEach(([i,y])=>{ie(y)&&(o[i]=JSON.stringify(y))});K.value=n,J.value=JSON.stringify(n,null,2)};function ie(u){const e=Object.prototype.toString.call(u);return e==="[object Object]"||e==="[object Array]"}return(u,e)=>{const s=ve,d=ye,n=fe,o=_e,i=ge,y=be,w=xe,I=ke,U=Se,p=De,b=he,W=Ee,pe=Ce;return m(),h(F,null,[f("div",Ue,[(m(!0),h(F,null,j(O.value,(t,$)=>(m(),T(y,{key:$,style:{width:"100%","margin-bottom":"5px"},class:"custom-margin"},{default:a(()=>[l(n,{span:3},{default:a(()=>[l(d,{modelValue:t.mustType,"onUpdate:modelValue":c=>t.mustType=c,placeholder:"\u8BF7\u9009\u62E9"},{default:a(()=>[l(s,{label:"must",value:"must"}),l(s,{label:"should",value:"should"}),l(s,{label:"mustNot",value:"mustNot"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(n,{span:3},{default:a(()=>[l(d,{filterable:"",modelValue:t.field,"onUpdate:modelValue":c=>t.field=c,placeholder:"\u8BF7\u9009\u62E9\u5B57\u6BB5"},{default:a(()=>[l(s,{key:"_id",label:"_id",value:"_id"}),(m(!0),h(F,null,j(V(L),c=>(m(),T(s,{key:c,label:c,value:c},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(n,{span:3},{default:a(()=>[l(d,{modelValue:t.searchType,"onUpdate:modelValue":c=>t.searchType=c,placeholder:"\u8BF7\u9009\u62E9"},{default:a(()=>[l(s,{label:"terms",value:"terms"}),l(s,{label:"match",value:"match"}),l(s,{label:"wildcard",value:"wildcard"}),l(s,{label:"lt",value:"lt"}),l(s,{label:"le",value:"le"}),l(s,{label:"gt",value:"gt"}),l(s,{label:"ge",value:"ge"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(n,{span:3},{default:a(()=>[l(o,{modelValue:t.searchKeyword,"onUpdate:modelValue":c=>t.searchKeyword=c,clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(n,{span:8},{default:a(()=>[l(i,{onClick:Z,type:"primary"},{default:a(()=>e[11]||(e[11]=[_("+")])),_:1}),l(i,{onClick:c=>ee($),type:"danger"},{default:a(()=>e[12]||(e[12]=[_("-")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),l(y,{style:{display:"flex","justify-content":"end","margin-top":"-0px","margin-right":"40px","flex-direction":"row"}},{default:a(()=>[l(n,{span:2},{default:a(()=>[l(i,{type:"primary",plain:"",onClick:X},{default:a(()=>e[13]||(e[13]=[_("JSON/\u8868\u683C")])),_:1})]),_:1}),l(n,{span:3},{default:a(()=>[l(d,{filterable:"",modelValue:C.value.sortName,"onUpdate:modelValue":e[0]||(e[0]=t=>C.value.sortName=t),placeholder:"\u8BF7\u9009\u62E9\u5B57\u6BB5"},{default:a(()=>[(m(!0),h(F,null,j(V(L),t=>(m(),T(s,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(n,{span:2},{default:a(()=>[l(d,{modelValue:C.value.sort,"onUpdate:modelValue":e[1]||(e[1]=t=>C.value.sort=t),placeholder:"\u8BF7\u9009\u62E9"},{default:a(()=>[l(s,{label:"DESC",value:"DESC"}),l(s,{label:"ASC",value:"ASC"})]),_:1},8,["modelValue"])]),_:1}),l(i,{onClick:G,plain:"",type:"primary"},{default:a(()=>e[14]||(e[14]=[_(" \u67E5\u8BE2 ")])),_:1})]),_:1})]),f("div",Ae,[f("div",Ke,[l(I,{width:"250px"},{default:a(()=>[l(w,null,{default:a(()=>[(m(!0),h(F,null,j(q.value,t=>(m(),h("p",{key:t,class:"scrollbar-demo-item",onClick:$=>se(t),style:je({background:v.value===t?"#84BEFC":"var(--el-color-primary-light-9)"})},Te(t),13,Je))),128))]),_:1})]),_:1}),we(f("div",Me,[l(y,{gutter:10},{default:a(()=>[l(p,{onCellDblclick:le,data:K.value,style:{"max-width":"1200px","max-height":"1000px","min-height":"100px"},size:"large"},{default:a(()=>[(m(!0),h(F,null,j(V(N),t=>(m(),T(U,{key:t.prop,label:t.label,prop:t.prop,width:"180"},null,8,["label","prop"]))),128))]),_:1},8,["data"])]),_:1}),l(y,{class:"row-bg",justify:"end"},{default:a(()=>[l(n,{span:1},{default:a(()=>[l(i,{type:"primary",plain:"",onClick:H},{default:a(()=>e[15]||(e[15]=[_("\u65B0\u589E")])),_:1})]),_:1})]),_:1})],512),[[Fe,K.value.length>0&&k.value=="table"]]),k.value=="json"?(m(),T(b,{key:0,class:"box-card"},{default:a(()=>[f("div",Le,[l(z,{value:J.value,"onUpdate:value":e[2]||(e[2]=t=>J.value=t),height:"600",width:"800",styles:"width: 100%",title:""},null,8,["value"]),l(y,{class:"row-bg",justify:"end"},{default:a(()=>[l(n,{span:1},{default:a(()=>[l(i,{type:"primary",plain:"",onClick:H},{default:a(()=>e[16]||(e[16]=[_("\u65B0\u589E")])),_:1})]),_:1})]),_:1})])]),_:1})):Ve("",!0)])]),f("div",Qe,[l(o,{modelValue:V(g),"onUpdate:modelValue":e[3]||(e[3]=t=>R(g)?g.value=t:g=t),placeholder:"\u8BF7\u8F93\u5165\u7D22\u5F15\u540D\u79F0",style:{width:"240px","margin-top":"0px","margin-left":"-15px"},onChange:P},null,8,["modelValue"]),l(i,{type:"primary",onClick:e[4]||(e[4]=t=>P()),plain:"",style:{width:"240px","margin-top":"10px","margin-left":"-15px"}},{default:a(()=>e[17]||(e[17]=[_("\u67E5\u8BE2\u8FC7\u6EE4")])),_:1}),l(i,{type:"primary",onClick:e[5]||(e[5]=t=>ue(v.value)),plain:"",style:{width:"240px","margin-top":"10px","margin-left":"-15px"}},{default:a(()=>e[18]||(e[18]=[_("\u67E5\u770B\u6620\u5C04")])),_:1})]),l(W,{modelValue:V(B),"onUpdate:modelValue":e[7]||(e[7]=t=>R(B)?B.value=t:B=t),title:"\u67E5\u770B\u6620\u5C04",style:{"max-width":"700px",position:"relative",height:"750px",transform:"translateY(-50px)"}},{default:a(()=>[f("div",null,[l(z,{value:A.value,"onUpdate:value":e[6]||(e[6]=t=>A.value=t),height:"600",styles:"width: 100%",title:"\u67E5\u770B\u6620\u5C04"},null,8,["value"])])]),_:1},8,["modelValue"]),l(W,{modelValue:V(E),"onUpdate:modelValue":e[10]||(e[10]=t=>R(E)?E.value=t:E=t),title:"\u5F53\u524D\u7D22\u5F15:"+v.value,style:{"max-width":"700px",position:"relative",height:"800px",transform:"translateY(-50px)"}},{default:a(()=>[f("div",$e,[l(pe,{label:"Routing (\u53EF\u9009):"},{default:a(()=>[l(o,{modelValue:x.value,"onUpdate:modelValue":e[8]||(e[8]=t=>x.value=t),placeholder:"\u8BF7\u8F93\u5165 routing \u503C\uFF08\u53EF\u9009\uFF0C\u7559\u7A7A\u5219\u4E0D\u4F7F\u7528 routing\uFF09",clearable:""},null,8,["modelValue"])]),_:1})]),f("div",null,[l(z,{value:D.value,"onUpdate:value":e[9]||(e[9]=t=>D.value=t),height:"550",styles:"width: 100%",title:"\u65B0\u589E\u6570\u636E\u6CE8\u610F:_id\u5FC5\u586B,\u5426\u5219\u4F1A\u81EA\u52A8\u751F\u6210id"},null,8,["value"])]),l(i,{type:"primary",onClick:ae,style:{position:"absolute",right:"10px",bottom:"10px"}},{default:a(()=>e[19]||(e[19]=[_(" \u4FDD\u5B58\u6570\u636E ")])),_:1})]),_:1},8,["modelValue","title"])],64)}}});const ll=Ne(Re,[["__scopeId","data-v-a6efc7ab"]]);export{ll as default};
