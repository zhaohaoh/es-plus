/* empty css               *//* empty css               *//* empty css               *//* empty css                     */import{d as Y,r as f,c as X,G as z,o as Z,H as be,g as A,l as h,j as p,t as Be,I as U,k as d,J as Te,u as _,_ as ee,K as De,L as ke,b as _e,e as Ae,M as Oe,N as Se,O as he,i as u,w as s,F as H,m as we,P as G,Q,R as P,n as Ke,E as J,S as Ne,T as Le,U as R,h as Ve,V as Ue}from"./index.6b10c4c5.js";import{h as Je,e as W,l as n,J as q}from"./index.1e9d2da1.js";const Re={key:0,class:"tools-box"},qe={key:0},je={key:0,class:"tools-list"},Me=Y({__name:"index",props:{read:{type:Boolean,default:()=>!1},title:{type:String,default:""},value:{type:String,default:()=>""},pointOut:{type:Array,default:()=>[]},height:{type:String,default:()=>"400"},fontSize:{type:Number,default:()=>18},language:{type:String,default:()=>"json"},showToolbar:{type:Boolean,default:()=>!0},showTools:{type:Boolean,default:()=>!0}},emits:["update:value"],setup(T,{expose:v,emit:K}){let V=f(!1),y=T,N=f(null),m=f(null),g=f("100%");const c=K;let a=null;const D=f(y.value),k=X({get(){return y.value},set(E){c("update:value",E)}}),O=()=>{a=W.create(N.value,{value:D.value,language:y.language,theme:"vs",automaticLayout:!0,fontSize:y.fontSize,wordWrap:"on",minimap:{enabled:!1},scrollBeyondLastLine:!1,readOnly:y.read}),V.value=!0,a.onDidChangeModelContent(()=>{k.value=a.getValue()}),n.registerCompletionItemProvider(y.language,{triggerCharacters:[" ","(",".",'"',"'"],provideCompletionItems:(C,j)=>{let I=[];if(y.pointOut&&y.pointOut.length>0&&(I=y.pointOut.map(b=>({label:b,kind:n.CompletionItemKind.Text,insertText:b,detail:"\u81EA\u5B9A\u4E49"}))),y.language==="sql"){const b=[{label:"SELECT",kind:n.CompletionItemKind.Keyword,insertText:"SELECT ",detail:"\u67E5\u8BE2\u8BED\u53E5"},{label:"FROM",kind:n.CompletionItemKind.Keyword,insertText:"FROM ",detail:"\u6307\u5B9A\u8868\u540D"},{label:"WHERE",kind:n.CompletionItemKind.Keyword,insertText:"WHERE ",detail:"\u6761\u4EF6\u8FC7\u6EE4"},{label:"AND",kind:n.CompletionItemKind.Keyword,insertText:" AND ",detail:"\u903B\u8F91\u4E0E"},{label:"OR",kind:n.CompletionItemKind.Keyword,insertText:" OR ",detail:"\u903B\u8F91\u6216"},{label:"ORDER BY",kind:n.CompletionItemKind.Keyword,insertText:"ORDER BY ",detail:"\u6392\u5E8F"},{label:"GROUP BY",kind:n.CompletionItemKind.Keyword,insertText:"GROUP BY ",detail:"\u5206\u7EC4"},{label:"HAVING",kind:n.CompletionItemKind.Keyword,insertText:"HAVING ",detail:"\u5206\u7EC4\u540E\u8FC7\u6EE4"},{label:"LIMIT",kind:n.CompletionItemKind.Keyword,insertText:"LIMIT ",detail:"\u9650\u5236\u884C\u6570"},{label:"OFFSET",kind:n.CompletionItemKind.Keyword,insertText:"OFFSET ",detail:"\u504F\u79FB\u91CF"},{label:"JOIN",kind:n.CompletionItemKind.Keyword,insertText:"JOIN ",detail:"\u8FDE\u63A5\u8868"},{label:"LEFT JOIN",kind:n.CompletionItemKind.Keyword,insertText:"LEFT JOIN ",detail:"\u5DE6\u8FDE\u63A5"},{label:"RIGHT JOIN",kind:n.CompletionItemKind.Keyword,insertText:"RIGHT JOIN ",detail:"\u53F3\u8FDE\u63A5"},{label:"INNER JOIN",kind:n.CompletionItemKind.Keyword,insertText:"INNER JOIN ",detail:"\u5185\u8FDE\u63A5"},{label:"UNION",kind:n.CompletionItemKind.Keyword,insertText:"UNION ",detail:"\u5408\u5E76\u7ED3\u679C\u96C6"},{label:"DISTINCT",kind:n.CompletionItemKind.Keyword,insertText:"DISTINCT ",detail:"\u53BB\u91CD"},{label:"COUNT",kind:n.CompletionItemKind.Function,insertText:"COUNT($1)",detail:"\u8BA1\u6570\u51FD\u6570"},{label:"SUM",kind:n.CompletionItemKind.Function,insertText:"SUM($1)",detail:"\u6C42\u548C\u51FD\u6570"},{label:"AVG",kind:n.CompletionItemKind.Function,insertText:"AVG($1)",detail:"\u5E73\u5747\u503C\u51FD\u6570"},{label:"MAX",kind:n.CompletionItemKind.Function,insertText:"MAX($1)",detail:"\u6700\u5927\u503C\u51FD\u6570"},{label:"MIN",kind:n.CompletionItemKind.Function,insertText:"MIN($1)",detail:"\u6700\u5C0F\u503C\u51FD\u6570"},{label:"=",kind:n.CompletionItemKind.Operator,insertText:" = ",detail:"\u7B49\u4E8E"},{label:"!=",kind:n.CompletionItemKind.Operator,insertText:" != ",detail:"\u4E0D\u7B49\u4E8E"},{label:"<>",kind:n.CompletionItemKind.Operator,insertText:" <> ",detail:"\u4E0D\u7B49\u4E8E"},{label:"<",kind:n.CompletionItemKind.Operator,insertText:" < ",detail:"\u5C0F\u4E8E"},{label:">",kind:n.CompletionItemKind.Operator,insertText:" > ",detail:"\u5927\u4E8E"},{label:"<=",kind:n.CompletionItemKind.Operator,insertText:" <= ",detail:"\u5C0F\u4E8E\u7B49\u4E8E"},{label:">=",kind:n.CompletionItemKind.Operator,insertText:" >= ",detail:"\u5927\u4E8E\u7B49\u4E8E"},{label:"LIKE",kind:n.CompletionItemKind.Operator,insertText:" LIKE ",detail:"\u6A21\u7CCA\u5339\u914D"},{label:"IN",kind:n.CompletionItemKind.Operator,insertText:" IN ",detail:"\u5305\u542B\u4E8E"},{label:"NOT IN",kind:n.CompletionItemKind.Operator,insertText:" NOT IN ",detail:"\u4E0D\u5305\u542B\u4E8E"},{label:"IS NULL",kind:n.CompletionItemKind.Operator,insertText:" IS NULL",detail:"\u4E3A\u7A7A"},{label:"IS NOT NULL",kind:n.CompletionItemKind.Operator,insertText:" IS NOT NULL",detail:"\u975E\u7A7A"},{label:"BETWEEN",kind:n.CompletionItemKind.Operator,insertText:" BETWEEN ",detail:"\u533A\u95F4"},{label:"EXISTS",kind:n.CompletionItemKind.Operator,insertText:"EXISTS ",detail:"\u5B58\u5728"},{label:"ASC",kind:n.CompletionItemKind.Keyword,insertText:" ASC",detail:"\u5347\u5E8F"},{label:"DESC",kind:n.CompletionItemKind.Keyword,insertText:" DESC",detail:"\u964D\u5E8F"},{label:"*",kind:n.CompletionItemKind.Operator,insertText:"*",detail:"\u6240\u6709\u5B57\u6BB5"}];I=[...I,...b]}return{suggestions:I}}})},F=()=>{a&&a.getAction("editor.action.formatDocument").run()},x=()=>{Je(k.value)};return z(()=>y.value,E=>{a&&E!==a.getValue()&&a.setValue(E)}),z(()=>y.language,E=>{if(a){const C=a.getModel();C&&W.setModelLanguage(C,E)}}),Z(()=>{be(()=>{O()})}),v({format:F,copy:x,getValue:()=>(a==null?void 0:a.getValue())||"",setValue:E=>{a&&a.setValue(E)}}),(E,C)=>(A(),h("div",{ref_key:"maxDiv",ref:m,style:{width:"100%"}},[T.showToolbar?(A(),h("div",Re,[p("div",null,[T.title!=""?(A(),h("span",qe,Be(T.title),1)):U("",!0)]),T.showTools?(A(),h("div",je,[p("span",{class:"aides",style:{"margin-right":"1rem"},onClick:F},C[0]||(C[0]=[p("i",{class:"el-icon-edit"},null,-1),d(" \u7F8E\u5316")])),p("span",{class:"aides",onClick:x},C[1]||(C[1]=[p("i",{class:"el-icon-delete"},null,-1),d(" \u590D\u5236")]))])):U("",!0)])):U("",!0),p("div",{id:"container",class:"monaco-editor",ref_key:"container",ref:N,style:Te({height:`${T.height}px`,width:_(g)})},null,4)],512))}});const $e=ee(Me,[["__scopeId","data-v-667f16a3"]]),ze={class:"container"},He={class:"left-panel"},Ge={class:"esQuery-container"},Qe={style:{"min-height":"30px"}},Pe={class:"esQuery-label"},We={class:"controls"},Ye={class:"right-panel"},Xe={class:"footer-button",justify:"end"},Ze={class:"dialog-footer"},et={style:{"margin-bottom":"10px"}},tt=Y({__name:"search",setup(T){const{proxy:v}=Ke();let K="SELECT * from fast_test_new_v128 order by id desc limit 10",V=`{
    "query": {
        "bool": {
            "must": [
              {
                "match_all": {}
              }
            ]
        }
    }
}`,y=`from BPSuvA
win
  window tumbling,
  keep these 
  ev: tumbletime > 60s;

@name(name) by 1m
select *
from BPSuvA
group by name
output first(1)`;const N=X(()=>{switch(g.value){case"sql":return"sql";case"epl":return"javascript";case"dsl":return"json";default:return"sql"}});let m=f(K),g=f("sql"),c=f("");const a=f(""),D=f(""),k=f(!1),O=f(!1),F=f(""),x=f(""),E=f([]);Z(()=>{M(),ne("")});const C=()=>{c.value&&navigator.clipboard.writeText(c.value).then(()=>J.success("\u590D\u5236\u6210\u529F")).catch(()=>j(c.value))};function j(l){const e=document.createElement("textarea");e.value=l,document.body.appendChild(e),e.select();try{const t=document.execCommand("copy")}catch(t){console.error("\u964D\u7EA7\u590D\u5236\u51FA\u9519:",t),alert(`\u81EA\u52A8\u590D\u5236\u5931\u8D25\uFF0C\u8BF7\u6309 Ctrl+C \u624B\u52A8\u590D\u5236\uFF1A
`+l)}document.body.removeChild(e)}const I=f(""),b=f(!1),te=async()=>{if(!c.value){J.error("\u8BF7\u9009\u62E9\u7D22\u5F15");return}le(c.value),b.value=!0},le=async l=>{const e={index:l};let t=await v.$api.esIndex.getIndex(e);I.value=JSON.stringify(t,null,2)},ne=async l=>{const e={keyword:l};let t=await v.$api.esIndex.indexList(e);E.value=t.indices},M=()=>{const l=localStorage.getItem("lastSql");l?m.value=l:m.value=K,g.value="sql"},ae=()=>{const l=localStorage.getItem("lastEpl");l?m.value=l:m.value=y,g.value="epl"},ue=()=>{const l=localStorage.getItem("lastDsl");l?m.value=l:m.value=V,g.value="dsl"},oe=()=>{let e=JSON.parse(a.value).hits.hits.map(t=>t._source).filter(Boolean);ie(e)},ie=async l=>{try{const e=await Ne({method:"post",url:"/es/file/excelExport",baseURL:Le.baseUrl,responseType:"blob",data:l}),t=se(e.headers)||"export.xlsx",o=new Blob([e.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),r=document.createElement("a");r.href=window.URL.createObjectURL(o),r.download=t,r.click(),window.URL.revokeObjectURL(r.href)}catch(e){console.error("\u5BFC\u51FA\u5931\u8D25:",e)}},se=l=>{const e=l["content-disposition"];if(!e)return"";const t=e.match(/filename="?(.+)"?/);return(t==null?void 0:t[1])||""},re=()=>{k.value=!0},de=()=>{console.log(D.value);const l=JSON.parse(a.value);let e=l.hits.hits.flatMap(t=>{var o;return((o=t._source)==null?void 0:o[D.value])||[]}).filter(Boolean);console.log(e),e.length<=0&&(e=l.hits.hits.flatMap(t=>{var o;return((o=t.fields)==null?void 0:o[D.value])||[]}).filter(Boolean)),k.value=!1,a.value=JSON.stringify(e)},pe=l=>{l.on("inputRead",function(e,t){/[a-zA-Z]/.test(t.text[0])&&e.showHint()})},me=()=>{g.value=="epl"&&Ee(m.value),g.value=="sql"&&ve(m.value),g.value=="dsl"&&ye(m.value)},ce=async()=>{const l={sql:m.value};let e=await v.$api.tools.sql2Dsl(l);const t=JSON.stringify(e,null,2);a.value=t},fe=async()=>{const l={sql:m.value};let e=await v.$api.tools.explain(l);const t=JSON.stringify(e,null,2);a.value=t},ye=async l=>{localStorage.setItem("lastDsl",l);const e={dsl:l,index:c.value};let t=await v.$api.tools.dslQuery(e);const o=JSON.stringify(t,null,2);a.value=o},Ee=async l=>{localStorage.setItem("lastEpl",l);const e={epl:l};let t=await v.$api.tools.eplQuery(e);const o=JSON.stringify(t,null,2);a.value=o},ve=async l=>{localStorage.setItem("lastSql",l);const e={sql:l};let t=await v.$api.tools.sqlQuery(e);const o=JSON.stringify(t,null,2);a.value=o},ge=()=>{x.value="",F.value="",O.value=!0},xe=()=>{c.value==null||c.value==""?J.success("\u7D22\u5F15\u540D\u79F0\u672A\u586B\u5199"):R.confirm("\u7D22\u5F15:"+c.value,"\u65B0\u589E\u6570\u636E",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",distinguishCancelAndClose:!0,dangerouslyUseHTMLString:!0}).then(()=>{const l=JSON.parse(F.value),e=[];Array.isArray(l)?e.push(...l):e.push(l),x.value&&x.value.trim()!==""&&e.forEach(t=>{t._routing=x.value.trim()}),$(c.value,e),O.value=!1,x.value="",F.value=""}).catch(()=>{})},Ce=()=>{if(a.value){const e=JSON.parse(a.value).hits.hits;if(e&&e.length>0){const t=e[0]._index,o=e.map(r=>{const w=r._source||r.fields||{},S={};return r.fields&&!r._source?Object.keys(w).forEach(L=>{const B=w[L];S[L]=Array.isArray(B)&&B.length===1?B[0]:B}):Object.assign(S,w),{_id:r._id,_routing:r._routing||"",...S}});console.log(t+o[0]._id),R.confirm("\u786E\u5B9A\u7F16\u8F91"+o[0]._id+"...\u603B\u8BA1"+o.length+"\u4E2A\u6570\u636E?","\u7F16\u8F91\u786E\u8BA4",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",distinguishCancelAndClose:!0,dangerouslyUseHTMLString:!0}).then(()=>{$(t,o)}).catch(()=>{})}}},Fe=()=>{if(a.value){const e=JSON.parse(a.value).hits.hits;if(e&&e.length>0){const t=e[0]._index,o=e.map(r=>({_id:r._id,_routing:r._routing||""}));console.log(t+o[0]._id),R.confirm("\u786E\u5B9A\u5220\u9664"+o[0]._id+"...\u603B\u8BA1"+o.length+"\u4E2A\u6570\u636E?","\u5220\u9664\u786E\u8BA4",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning",distinguishCancelAndClose:!0,showCancelButton:!0,dangerouslyUseHTMLString:!0}).then(()=>{console.log("\u786E\u8BA4\u5220\u9664"),Ie(t,o)}).catch(()=>{})}}},Ie=async(l,e)=>{const t={index:l,datas:e};let o=await v.$api.tools.deleteByIds(t);const r=JSON.stringify(o,null,2);a.value=r},$=async(l,e)=>{const t={index:l,datas:e};console.log(t),await v.$api.tools.updateBatch(t)};return(l,e)=>{const t=De,o=ke,r=_e,w=Ae,S=Oe,L=Se,B=he;return A(),h(H,null,[p("div",ze,[p("div",He,[p("div",Ge,[u(o,{style:{"margin-top":"-10px","margin-bottom":"10px"}},{default:s(()=>[u(t,{type:"primary",plain:"",size:"small",onClick:M},{default:s(()=>e[10]||(e[10]=[d("SQL")])),_:1}),u(t,{type:"primary",plain:"",size:"small",onClick:ae},{default:s(()=>e[11]||(e[11]=[d("EPL")])),_:1}),u(t,{type:"primary",plain:"",size:"small",onClick:ue},{default:s(()=>e[12]||(e[12]=[d("DSL")])),_:1})]),_:1}),p("div",Qe,[u(w,{modelValue:_(c),"onUpdate:modelValue":e[0]||(e[0]=i=>G(c)?c.value=i:c=i),placeholder:"\u7D22\u5F15",filterable:"",style:{width:"400px","margin-bottom":"10px"}},{default:s(()=>[(A(!0),h(H,null,we(E.value,i=>(A(),Ve(r,{key:i,label:i,value:i},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),u(t,{onClick:C,type:"primary",style:{"margin-left":"10px","margin-bottom":"10px"},plain:""},{default:s(()=>e[13]||(e[13]=[d("\u590D\u5236\u540D\u79F0 ")])),_:1}),u(t,{type:"primary",onClick:te,plain:"",style:{"margin-left":"10px","margin-bottom":"10px"}},{default:s(()=>e[14]||(e[14]=[d("\u67E5\u770B\u7D22\u5F15")])),_:1})]),p("label",Pe,[u($e,{value:_(m),"onUpdate:value":e[1]||(e[1]=i=>G(m)?m.value=i:m=i),ref:"sqlEditor",language:N.value,height:"630",showToolbar:!1,class:"json-input",title:"",onReady:pe},null,8,["value","language"])]),p("div",We,[Q(u(t,{size:"small",onClick:ce,type:"primary",plain:""},{default:s(()=>e[15]||(e[15]=[d("\u8F6CDSL")])),_:1},512),[[P,_(g)=="sql"]]),Q(u(t,{size:"small",onClick:fe,type:"primary",plain:""},{default:s(()=>e[16]||(e[16]=[d("\u8F93\u51FA\u6267\u884C\u8BA1\u5212")])),_:1},512),[[P,_(g)=="sql"]]),u(t,{size:"small",icon:_(Ue),onClick:me,plain:"",type:"primary"},{default:s(()=>e[17]||(e[17]=[d("\u641C\u7D22")])),_:1},8,["icon"])])])]),p("div",Ye,[u(q,{value:a.value,"onUpdate:value":e[2]||(e[2]=i=>a.value=i),height:"650",styles:"width: 100%",title:"\u67E5\u8BE2\u7ED3\u679C",class:"json-output",style:{"margin-top":"20px"}},null,8,["value"]),p("div",Xe,[p("span",Ze,[u(t,{onClick:ge,type:"primary",size:"small",plain:""},{default:s(()=>e[18]||(e[18]=[d("\u65B0\u589E")])),_:1}),u(t,{onClick:Ce,type:"warning",size:"small",plain:""},{default:s(()=>e[19]||(e[19]=[d("\u4FEE\u6539")])),_:1}),u(t,{type:"danger",onClick:Fe,size:"small",plain:""},{default:s(()=>e[20]||(e[20]=[d("\u5220\u9664")])),_:1}),u(t,{type:"info",onClick:re,size:"small",plain:""},{default:s(()=>e[21]||(e[21]=[d("\u66F4\u591A\u64CD\u4F5C")])),_:1})])])])]),u(B,{modelValue:O.value,"onUpdate:modelValue":e[5]||(e[5]=i=>O.value=i),title:"\u5F53\u524D\u7D22\u5F15:"+_(c),style:{"max-width":"700px",position:"relative",height:"800px",transform:"translateY(-50px)"}},{default:s(()=>[p("div",et,[u(L,{label:"Routing (\u53EF\u9009):"},{default:s(()=>[u(S,{modelValue:x.value,"onUpdate:modelValue":e[3]||(e[3]=i=>x.value=i),placeholder:"\u8BF7\u8F93\u5165 routing \u503C\uFF08\u53EF\u9009\uFF0C\u7559\u7A7A\u5219\u4E0D\u4F7F\u7528 routing\uFF09",clearable:""},null,8,["modelValue"])]),_:1})]),p("div",null,[u(q,{value:F.value,"onUpdate:value":e[4]||(e[4]=i=>F.value=i),height:"550",styles:"width: 100%",title:"\u65B0\u589E\u6570\u636E\u6CE8\u610F:_id\u5FC5\u586B,\u5426\u5219\u4F1A\u81EA\u52A8\u751F\u6210id"},null,8,["value"])]),u(t,{type:"primary",onClick:xe,style:{position:"absolute",right:"10px",bottom:"10px"}},{default:s(()=>e[22]||(e[22]=[d(" \u4FDD\u5B58\u6570\u636E ")])),_:1})]),_:1},8,["modelValue","title"]),u(B,{modelValue:k.value,"onUpdate:modelValue":e[7]||(e[7]=i=>k.value=i),title:"\u66F4\u591A\u64CD\u4F5C",style:{width:"600px","max-width":"600px",position:"relative",height:"200px",transform:"translateX(50px)"}},{default:s(()=>[u(o,{style:{"margin-top":"0px","margin-bottom":"11px"}},{default:s(()=>[u(t,{type:"primary",plain:""},{default:s(()=>e[23]||(e[23]=[d("\u63D0\u53D6\u5B57\u6BB5")])),_:1}),u(t,{type:"primary",plain:"",onClick:oe},{default:s(()=>e[24]||(e[24]=[d("\u6570\u636E\u5BFC\u51FA")])),_:1})]),_:1}),u(S,{modelValue:D.value,"onUpdate:modelValue":e[6]||(e[6]=i=>D.value=i)},null,8,["modelValue"]),u(t,{type:"primary",plain:"",onClick:de,style:{position:"absolute",right:"10px",bottom:"10px"}},{default:s(()=>e[25]||(e[25]=[d("\u786E\u8BA4\u8F6C\u6362 ")])),_:1})]),_:1},8,["modelValue"]),u(B,{modelValue:b.value,"onUpdate:modelValue":e[9]||(e[9]=i=>b.value=i),title:"\u7D22\u5F15\u4FE1\u606F",style:{width:"900px","max-width":"1000px",position:"relative",height:"750px",transform:"translateY(-50px)"}},{default:s(()=>[p("div",null,[u(q,{value:I.value,"onUpdate:value":e[8]||(e[8]=i=>I.value=i),height:"600",styles:"width: 100%",title:"\u7D22\u5F15\u4FE1\u606F"},null,8,["value"])])]),_:1},8,["modelValue"])],64)}}});const st=ee(tt,[["__scopeId","data-v-228bbb5b"]]);export{st as default};
