/* empty css               *//* empty css               */import{_ as te}from"./index.c2673515.js";/* empty css                     *//* empty css                *//* empty css              *//* empty css               */import{d as oe,r as d,o as se,E as ue,a as ne,b as re,P as de,M as ie,c as pe,a7 as ce,O as me,e as c,h as _,Q as g,F as E,i as k,g as l,w as t,u as w,n as h,a8 as ye,a9 as fe,R as $,S as ve,t as _e,a6 as ge,f as U,K as he,$ as xe,j as be,a5 as Ee,_ as we}from"./index.78e97f46.js";import{e as Ve}from"./message.7bac5a96.js";const Be={class:"searchForm",style:{"max-height":"200px","margin-left":"-15px"}},Ce={class:"container",style:{"margin-left":"-20px","margin-top":"10px"}},ke={class:"buju"},Fe=["onClick"],Te={class:"right-container",style:{"margin-top":"-20px"}},De={class:"downIndex"},Se=oe({__name:"esTable",setup(Ne){let V=d(!1),B=d(!1);const I=d(""),O=d("{}");let v=d("");const J=()=>{localStorage.setItem("indexKeyword",v.value),R(v.value)},F=d([{mustType:"must",field:"",searchType:"terms",searchKeyword:"",sortName:"_id",sort:"DESC"}]),x=d({sortName:"_id",sort:"DESC"}),Y=()=>{F.value.push({mustType:"must",field:"",searchType:"terms",searchKeyword:"",sortName:"",sort:""})},q=o=>{F.value.splice(o,1)},T=d([]),L=d([]),M=d();let j=d();const Q=d([]),{proxy:D}=be(),H=async o=>{B.value=!0},G=async()=>{const o={index:m.value,datas:[JSON.parse(O.value)]};console.log("baocun :"+JSON.stringify(o)),await D.$api.tools.updateBatch(o),Ve.success()},W=async o=>{await X(o),V.value=!0,m.value=o},X=async o=>{const e={indexName:o};let u=await D.$api.esIndex.getMapping(e);I.value=JSON.stringify(u,null,2)},m=d(),Z=o=>{m.value=o,M.value=L.value[m.value],j.value=Object.keys(M.value),z()},R=async o=>{const e={keyword:o};let u=await D.$api.esIndex.indexList(e);L.value=u.flatMappings,Q.value=u.indices};let S=[];const ee=d("Es.chainQuery()");se(()=>{R("");const o=localStorage.getItem("indexKeyword");o!=null&&(v.value=o)});const z=()=>{if(!m.value||m.value==null){ve("\u8BF7\u9009\u62E9\u7D22\u5F15");return}le()},le=async()=>{let o=ee.value+'.index("'+m.value+'")';F.value.forEach(e=>{if(e&&e.searchType&&e.field&&e.searchKeyword){const u=e.mustType;o+="."+u+"()";let i=e.searchKeyword;e.field=="_id"&&(i='"'+e.searchKeyword+'"'),Object.entries(M.value).forEach(([n,s])=>{n==e.field&&(s=="text"||s=="keyword")&&(i='"'+e.searchKeyword+'"'),n==e.field&&s=="long"&&(i=e.searchKeyword+"L")}),o+="."+e.searchType+'("'+e.field+'",'+i+")"}}),o=o+'.sortBy("'+x.value.sort+'","'+x.value.sortName+'")',o+=".search(10)",console.log(o),ae(o)},ae=async o=>{const e={epl:o},i=(await D.$api.tools.eplQuery(e)).hits.hits;i.forEach(s=>s._source._id=s._id);const n=i.map(s=>s._source);if(n!=null&&n.length>0){let s,y=0;for(const r of n){const f=Object.keys(r);f.length>y&&(y=f.length,s=f)}s.push("_id");const b=Object.entries(n[0]),C=[];b.forEach(([r,f])=>{f!=null&&f!==""&&C.push(r)}),s=s.filter(r=>!C.includes(r)),s.unshift(...C);const N=s.indexOf("id");if(N>-1){const[r]=s.splice(N,1);s.unshift(r)}const K=s.indexOf("_id");if(K>-1){const[r]=s.splice(K,1);s.unshift(r)}S.length=0,s.forEach(r=>{S.push({prop:r,label:r})}),console.log("\u8868\u5934"+s),console.log("\u8868\u5934:::"+JSON.stringify(S))}T.value=n,console.log(T.value)};return(o,e)=>{const u=ue,i=ne,n=re,s=de,y=ie,b=pe,C=ce,N=_e,K=Ee,r=ge,f=te,P=me;return c(),_(E,null,[g("div",Be,[(c(!0),_(E,null,k(F.value,(a,A)=>(c(),U(b,{key:A,style:{width:"100%","margin-bottom":"5px"},class:"custom-margin"},{default:t(()=>[l(n,{span:3},{default:t(()=>[l(i,{modelValue:a.mustType,"onUpdate:modelValue":p=>a.mustType=p,placeholder:"\u8BF7\u9009\u62E9"},{default:t(()=>[l(u,{label:"must",value:"must"}),l(u,{label:"should",value:"should"}),l(u,{label:"mustNot",value:"mustNot"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(n,{span:3},{default:t(()=>[l(i,{filterable:"",modelValue:a.field,"onUpdate:modelValue":p=>a.field=p,placeholder:"\u8BF7\u9009\u62E9\u5B57\u6BB5"},{default:t(()=>[l(u,{key:"_id",label:"_id",value:"_id"}),(c(!0),_(E,null,k(w(j),p=>(c(),U(u,{key:p,label:p,value:p},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(n,{span:3},{default:t(()=>[l(i,{modelValue:a.searchType,"onUpdate:modelValue":p=>a.searchType=p,placeholder:"\u8BF7\u9009\u62E9"},{default:t(()=>[l(u,{label:"terms",value:"terms"}),l(u,{label:"match",value:"match"}),l(u,{label:"wildcard",value:"wildcard"}),l(u,{label:"lt",value:"lt"}),l(u,{label:"le",value:"le"}),l(u,{label:"gt",value:"gt"}),l(u,{label:"ge",value:"ge"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(n,{span:3},{default:t(()=>[l(s,{modelValue:a.searchKeyword,"onUpdate:modelValue":p=>a.searchKeyword=p,clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(n,{span:8},{default:t(()=>[l(y,{onClick:Y,type:"primary"},{default:t(()=>e[9]||(e[9]=[h("+")])),_:1}),l(y,{onClick:p=>q(A),type:"danger"},{default:t(()=>e[10]||(e[10]=[h("-")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),l(b,{style:{display:"flex","justify-content":"end","margin-top":"-0px","margin-right":"40px","flex-direction":"row"}},{default:t(()=>[l(n,{span:1}),l(n,{span:3},{default:t(()=>[l(i,{filterable:"",modelValue:x.value.sortName,"onUpdate:modelValue":e[0]||(e[0]=a=>x.value.sortName=a),placeholder:"\u8BF7\u9009\u62E9\u5B57\u6BB5"},{default:t(()=>[(c(!0),_(E,null,k(w(j),a=>(c(),U(u,{key:a,label:a,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(n,{span:2},{default:t(()=>[l(i,{modelValue:x.value.sort,"onUpdate:modelValue":e[1]||(e[1]=a=>x.value.sort=a),placeholder:"\u8BF7\u9009\u62E9"},{default:t(()=>[l(u,{label:"DESC",value:"DESC"}),l(u,{label:"ASC",value:"ASC"})]),_:1},8,["modelValue"])]),_:1}),l(y,{onClick:z,plain:"",type:"primary"},{default:t(()=>e[11]||(e[11]=[h(" \u67E5\u8BE2 ")])),_:1})]),_:1})]),g("div",Ce,[g("div",ke,[l(N,{width:"250px"},{default:t(()=>[l(C,{height:"600px"},{default:t(()=>[(c(!0),_(E,null,k(Q.value,a=>(c(),_("p",{key:a,class:"scrollbar-demo-item",onClick:A=>Z(a),style:he({background:m.value===a?"#84BEFC":"var(--el-color-primary-light-9)"})},xe(a),13,Fe))),128))]),_:1})]),_:1}),ye(g("div",Te,[l(b,{gutter:10},{default:t(()=>[l(r,{data:T.value,style:{"max-width":"1200px","max-height":"1000px","min-height":"300px"},size:"large"},{default:t(()=>[(c(!0),_(E,null,k(w(S),a=>(c(),U(K,{key:a.prop,label:a.label,prop:a.prop,width:"150"},null,8,["label","prop"]))),128))]),_:1},8,["data"])]),_:1}),l(b,{class:"row-bg",justify:"end"},{default:t(()=>[l(n,{span:1},{default:t(()=>[l(y,{type:"primary",plain:"",onClick:H},{default:t(()=>e[12]||(e[12]=[h("\u65B0\u589E")])),_:1})]),_:1})]),_:1})],512),[[fe,T.value.length>0]])])]),g("div",De,[l(s,{modelValue:w(v),"onUpdate:modelValue":e[2]||(e[2]=a=>$(v)?v.value=a:v=a),placeholder:"\u8BF7\u8F93\u5165\u7D22\u5F15\u540D\u79F0",style:{width:"240px","margin-top":"20px","margin-left":"-15px"},onChange:J},null,8,["modelValue"]),l(y,{type:"primary",onClick:e[3]||(e[3]=a=>J()),plain:"",style:{width:"240px","margin-top":"10px","margin-left":"-15px"}},{default:t(()=>e[13]||(e[13]=[h("\u67E5\u8BE2\u8FC7\u6EE4")])),_:1}),l(y,{type:"primary",onClick:e[4]||(e[4]=a=>W(m.value)),plain:"",style:{width:"240px","margin-top":"10px","margin-left":"-15px"}},{default:t(()=>e[14]||(e[14]=[h("\u67E5\u770B\u6620\u5C04")])),_:1})]),l(P,{modelValue:w(V),"onUpdate:modelValue":e[6]||(e[6]=a=>$(V)?V.value=a:V=a),title:"\u67E5\u770B\u6620\u5C04",style:{"max-width":"700px",position:"relative",height:"750px",transform:"translateY(-50px)"}},{default:t(()=>[g("div",null,[l(f,{value:I.value,"onUpdate:value":e[5]||(e[5]=a=>I.value=a),height:"600",styles:"width: 100%",title:"\u67E5\u770B\u6620\u5C04"},null,8,["value"])])]),_:1},8,["modelValue"]),l(P,{modelValue:w(B),"onUpdate:modelValue":e[8]||(e[8]=a=>$(B)?B.value=a:B=a),title:"\u5F53\u524D\u7D22\u5F15:"+m.value,style:{"max-width":"700px",position:"relative",height:"750px",transform:"translateY(-50px)"}},{default:t(()=>[g("div",null,[l(f,{value:O.value,"onUpdate:value":e[7]||(e[7]=a=>O.value=a),height:"600",styles:"width: 100%",title:"\u65B0\u589E\u6570\u636E\u6CE8\u610F:_id\u5FC5\u586B,\u5426\u5219\u4F1A\u81EA\u52A8\u751F\u6210id"},null,8,["value"])]),l(y,{type:"primary",onClick:G,style:{position:"absolute",right:"10px",bottom:"10px"}},{default:t(()=>e[15]||(e[15]=[h(" \u4FDD\u5B58\u6570\u636E ")])),_:1})]),_:1},8,["modelValue","title"])],64)}}});const Le=we(Se,[["__scopeId","data-v-e06ae6e5"]]);export{Le as default};
