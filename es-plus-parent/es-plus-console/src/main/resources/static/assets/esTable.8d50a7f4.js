/* empty css               *//* empty css               */import{_ as se}from"./index.0639d680.js";/* empty css                     *//* empty css                *//* empty css              *//* empty css               */import{d as ue,r as d,o as ne,E as re,a as ie,b as de,P as pe,M as ce,c as me,a9 as ye,O as fe,e as m,h as g,Q as b,F as w,i as k,g as l,w as o,u as V,n as x,S as ve,T as _e,R as J,U as ge,t as be,a8 as xe,f as N,K as he,a1 as Ee,j as we,a7 as Ve,_ as Ce}from"./index.220bd387.js";import{e as Be}from"./message.fced8b85.js";const ke={class:"searchForm",style:{"max-height":"200px","margin-left":"-15px"}},Te={class:"container",style:{"margin-left":"-20px","margin-top":"10px"}},Fe={class:"buju"},De=["onClick"],Se={class:"right-container",style:{"margin-top":"-20px"}},Oe={class:"downIndex"},je=ue({__name:"esTable",setup(Ne){let C=d(!1),B=d(!1);const U=d(""),K=d("{}");let _=d("");const L=()=>{localStorage.setItem("indexKeyword",_.value),R(_.value)},T=d([{mustType:"must",field:"",searchType:"terms",searchKeyword:"",sortName:"_id",sort:"DESC"}]),h=d({sortName:"_id",sort:"DESC"}),Y=()=>{T.value.push({mustType:"must",field:"",searchType:"terms",searchKeyword:"",sortName:"",sort:""})},q=a=>{T.value.splice(a,1)},F=d([]),Q=d([]),I=d();let M=d();const $=d([]),{proxy:D}=we(),H=async(a,e,u,r)=>{const n=r.target.innerText;navigator.clipboard.writeText(n)},G=async a=>{B.value=!0},W=async()=>{const a={index:y.value,datas:[JSON.parse(K.value)]};console.log("baocun :"+JSON.stringify(a)),await D.$api.tools.updateBatch(a),Be.success()},X=async a=>{await Z(a),C.value=!0,y.value=a},Z=async a=>{const e={indexName:a};let u=await D.$api.esIndex.getMapping(e);U.value=JSON.stringify(u,null,2)},y=d(),ee=a=>{y.value=a,I.value=Q.value[y.value],M.value=Object.keys(I.value),z()},R=async a=>{const e={keyword:a};let u=await D.$api.esIndex.indexList(e);Q.value=u.flatMappings,$.value=u.indices};let S=[];const le=d("Es.chainQuery()");ne(()=>{R("");const a=localStorage.getItem("indexKeyword");a!=null&&(_.value=a)});const z=()=>{if(!y.value||y.value==null){ge("\u8BF7\u9009\u62E9\u7D22\u5F15");return}te()},te=async()=>{let a=le.value+'.index("'+y.value+'")';T.value.forEach(e=>{if(e&&e.searchType&&e.field&&e.searchKeyword){const u=e.mustType;a+="."+u+"()";let r=e.searchKeyword;e.field=="_id"&&(r='"'+e.searchKeyword+'"'),Object.entries(I.value).forEach(([n,s])=>{n==e.field&&(s=="text"||s=="keyword")&&(r='"'+e.searchKeyword+'"'),n==e.field&&s=="long"&&(r=e.searchKeyword+"L")}),a+="."+e.searchType+'("'+e.field+'",'+r+")"}}),a=a+'.sortBy("'+h.value.sort+'","'+h.value.sortName+'")',a+=".search(10)",console.log(a),ae(a)},ae=async a=>{const e={epl:a},r=(await D.$api.tools.eplQuery(e)).hits.hits;r.forEach(s=>s._source._id=s._id);const n=r.map(s=>s._source);if(n!=null&&n.length>0){let s,p=0;for(const i of n){const v=Object.keys(i);v.length>p&&(p=v.length,s=v)}s.push("_id");const f=Object.entries(n[0]),E=[];f.forEach(([i,v])=>{v!=null&&v!==""&&E.push(i)}),s=s.filter(i=>!E.includes(i)),s.unshift(...E);const O=s.indexOf("id");if(O>-1){const[i]=s.splice(O,1);s.unshift(i)}const j=s.indexOf("_id");if(j>-1){const[i]=s.splice(j,1);s.unshift(i)}S.length=0,s.forEach(i=>{S.push({prop:i,label:i})}),console.log("\u8868\u5934"+s),console.log("\u8868\u5934:::"+JSON.stringify(S))}for(const s of n)Object.entries(s).forEach(([p,f])=>{oe(f)&&(s[p]=JSON.stringify(f))});F.value=n,console.log(F.value)};function oe(a){const e=Object.prototype.toString.call(a);return e==="[object Object]"||e==="[object Array]"}return(a,e)=>{const u=re,r=ie,n=de,s=pe,p=ce,f=me,E=ye,O=be,j=Ve,i=xe,v=se,P=fe;return m(),g(w,null,[b("div",ke,[(m(!0),g(w,null,k(T.value,(t,A)=>(m(),N(f,{key:A,style:{width:"100%","margin-bottom":"5px"},class:"custom-margin"},{default:o(()=>[l(n,{span:3},{default:o(()=>[l(r,{modelValue:t.mustType,"onUpdate:modelValue":c=>t.mustType=c,placeholder:"\u8BF7\u9009\u62E9"},{default:o(()=>[l(u,{label:"must",value:"must"}),l(u,{label:"should",value:"should"}),l(u,{label:"mustNot",value:"mustNot"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(n,{span:3},{default:o(()=>[l(r,{filterable:"",modelValue:t.field,"onUpdate:modelValue":c=>t.field=c,placeholder:"\u8BF7\u9009\u62E9\u5B57\u6BB5"},{default:o(()=>[l(u,{key:"_id",label:"_id",value:"_id"}),(m(!0),g(w,null,k(V(M),c=>(m(),N(u,{key:c,label:c,value:c},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(n,{span:3},{default:o(()=>[l(r,{modelValue:t.searchType,"onUpdate:modelValue":c=>t.searchType=c,placeholder:"\u8BF7\u9009\u62E9"},{default:o(()=>[l(u,{label:"terms",value:"terms"}),l(u,{label:"match",value:"match"}),l(u,{label:"wildcard",value:"wildcard"}),l(u,{label:"lt",value:"lt"}),l(u,{label:"le",value:"le"}),l(u,{label:"gt",value:"gt"}),l(u,{label:"ge",value:"ge"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(n,{span:3},{default:o(()=>[l(s,{modelValue:t.searchKeyword,"onUpdate:modelValue":c=>t.searchKeyword=c,clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(n,{span:8},{default:o(()=>[l(p,{onClick:Y,type:"primary"},{default:o(()=>e[9]||(e[9]=[x("+")])),_:1}),l(p,{onClick:c=>q(A),type:"danger"},{default:o(()=>e[10]||(e[10]=[x("-")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),l(f,{style:{display:"flex","justify-content":"end","margin-top":"-0px","margin-right":"40px","flex-direction":"row"}},{default:o(()=>[l(n,{span:1}),l(n,{span:3},{default:o(()=>[l(r,{filterable:"",modelValue:h.value.sortName,"onUpdate:modelValue":e[0]||(e[0]=t=>h.value.sortName=t),placeholder:"\u8BF7\u9009\u62E9\u5B57\u6BB5"},{default:o(()=>[(m(!0),g(w,null,k(V(M),t=>(m(),N(u,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(n,{span:2},{default:o(()=>[l(r,{modelValue:h.value.sort,"onUpdate:modelValue":e[1]||(e[1]=t=>h.value.sort=t),placeholder:"\u8BF7\u9009\u62E9"},{default:o(()=>[l(u,{label:"DESC",value:"DESC"}),l(u,{label:"ASC",value:"ASC"})]),_:1},8,["modelValue"])]),_:1}),l(p,{onClick:z,plain:"",type:"primary"},{default:o(()=>e[11]||(e[11]=[x(" \u67E5\u8BE2 ")])),_:1})]),_:1})]),b("div",Te,[b("div",Fe,[l(O,{width:"250px"},{default:o(()=>[l(E,{height:"600px"},{default:o(()=>[(m(!0),g(w,null,k($.value,t=>(m(),g("p",{key:t,class:"scrollbar-demo-item",onClick:A=>ee(t),style:he({background:y.value===t?"#84BEFC":"var(--el-color-primary-light-9)"})},Ee(t),13,De))),128))]),_:1})]),_:1}),ve(b("div",Se,[l(f,{gutter:10},{default:o(()=>[l(i,{onCellDblclick:H,data:F.value,style:{"max-width":"1200px","max-height":"1000px","min-height":"300px"},size:"large"},{default:o(()=>[(m(!0),g(w,null,k(V(S),t=>(m(),N(j,{key:t.prop,label:t.label,prop:t.prop,width:"180"},null,8,["label","prop"]))),128))]),_:1},8,["data"])]),_:1}),l(f,{class:"row-bg",justify:"end"},{default:o(()=>[l(n,{span:1},{default:o(()=>[l(p,{type:"primary",plain:"",onClick:G},{default:o(()=>e[12]||(e[12]=[x("\u65B0\u589E")])),_:1})]),_:1})]),_:1})],512),[[_e,F.value.length>0]])])]),b("div",Oe,[l(s,{modelValue:V(_),"onUpdate:modelValue":e[2]||(e[2]=t=>J(_)?_.value=t:_=t),placeholder:"\u8BF7\u8F93\u5165\u7D22\u5F15\u540D\u79F0",style:{width:"240px","margin-top":"20px","margin-left":"-15px"},onChange:L},null,8,["modelValue"]),l(p,{type:"primary",onClick:e[3]||(e[3]=t=>L()),plain:"",style:{width:"240px","margin-top":"10px","margin-left":"-15px"}},{default:o(()=>e[13]||(e[13]=[x("\u67E5\u8BE2\u8FC7\u6EE4")])),_:1}),l(p,{type:"primary",onClick:e[4]||(e[4]=t=>X(y.value)),plain:"",style:{width:"240px","margin-top":"10px","margin-left":"-15px"}},{default:o(()=>e[14]||(e[14]=[x("\u67E5\u770B\u6620\u5C04")])),_:1})]),l(P,{modelValue:V(C),"onUpdate:modelValue":e[6]||(e[6]=t=>J(C)?C.value=t:C=t),title:"\u67E5\u770B\u6620\u5C04",style:{"max-width":"700px",position:"relative",height:"750px",transform:"translateY(-50px)"}},{default:o(()=>[b("div",null,[l(v,{value:U.value,"onUpdate:value":e[5]||(e[5]=t=>U.value=t),height:"600",styles:"width: 100%",title:"\u67E5\u770B\u6620\u5C04"},null,8,["value"])])]),_:1},8,["modelValue"]),l(P,{modelValue:V(B),"onUpdate:modelValue":e[8]||(e[8]=t=>J(B)?B.value=t:B=t),title:"\u5F53\u524D\u7D22\u5F15:"+y.value,style:{"max-width":"700px",position:"relative",height:"750px",transform:"translateY(-50px)"}},{default:o(()=>[b("div",null,[l(v,{value:K.value,"onUpdate:value":e[7]||(e[7]=t=>K.value=t),height:"600",styles:"width: 100%",title:"\u65B0\u589E\u6570\u636E\u6CE8\u610F:_id\u5FC5\u586B,\u5426\u5219\u4F1A\u81EA\u52A8\u751F\u6210id"},null,8,["value"])]),l(p,{type:"primary",onClick:W,style:{position:"absolute",right:"10px",bottom:"10px"}},{default:o(()=>e[15]||(e[15]=[x(" \u4FDD\u5B58\u6570\u636E ")])),_:1})]),_:1},8,["modelValue","title"])],64)}}});const Re=Ce(je,[["__scopeId","data-v-e04b634e"]]);export{Re as default};
