/* empty css               *//* empty css               *//* empty css                     *//* empty css                *//* empty css              *//* empty css               */import{d as ie,r,o as de,a as pe,b as ce,c as me,Q as ye,N as fe,e as ve,a9 as ge,aa as _e,P as be,f as m,i as x,R as b,F as w,j as T,h as l,w as a,p as v,u as C,T as xe,U as he,g as j,a2 as Ee,S as $,E as we,v as Ce,a8 as Ve,L as ke,a1 as Be,k as Te,a7 as je,_ as Fe}from"./index.db5907e6.js";import{e as Se}from"./message.03560eb3.js";import{J as R}from"./index.53a34409.js";const De={class:"searchForm",style:{"max-height":"200px","margin-left":"-15px"}},Ne={class:"container",style:{"margin-left":"-20px","margin-top":"10px"}},Oe={class:"buju"},Ue=["onClick"],Ie={class:"right-container",style:{"margin-top":"-20px"}},Ke={class:"right-container"},Je={class:"downIndex"},Me=ie({__name:"esTable",setup(Ae){let V=r(!1),k=r(!1);const U=r(""),B=r("json"),I=r("{}");let g=r("");const W=()=>{B.value=B.value==="json"?"table":"json",console.log("\u8868\u683C\u63A7\u5236\u503C"+B.value)},z=()=>{localStorage.setItem("indexKeyword",g.value),L(g.value)},F=r([{mustType:"must",field:"",searchType:"terms",searchKeyword:"",sortName:"_id",sort:"DESC"}]),h=r({sortName:"_id",sort:"DESC"}),X=()=>{F.value.push({mustType:"must",field:"",searchType:"terms",searchKeyword:"",sortName:"",sort:""})},Z=o=>{F.value.splice(o,1)},K=r([]),J=r(""),P=r([]),M=r();let A=r();const Y=r([]),{proxy:S}=Te(),ee=async(o,e,u,i)=>{const n=i.target.innerText;navigator.clipboard.writeText(n)},q=async o=>{k.value=!0},le=async()=>{const o={index:y.value,datas:[JSON.parse(I.value)]};console.log("baocun :"+JSON.stringify(o)),await S.$api.tools.updateBatch(o),Se.success()},te=async o=>{await ae(o),V.value=!0,y.value=o},ae=async o=>{const e={indexName:o};let u=await S.$api.esIndex.getMapping(e);U.value=JSON.stringify(u,null,2)},y=r(),oe=o=>{y.value=o,M.value=P.value[y.value],A.value=Object.keys(M.value),H()},L=async o=>{const e={keyword:o};let u=await S.$api.esIndex.indexList(e);P.value=u.flatMappings,Y.value=u.indices};let D=[];const se=r("Es.chainQuery()");de(()=>{const o=localStorage.getItem("indexKeyword");o!=null?(g.value=o,L(g.value)):L("")});const H=()=>{if(!y.value||y.value==null){we("\u8BF7\u9009\u62E9\u7D22\u5F15");return}ue()},ue=async()=>{let o=se.value+'.index("'+y.value+'")';F.value.forEach(e=>{if(e&&e.searchType&&e.field&&e.searchKeyword){const u=e.mustType;o+="."+u+"()";let i=e.searchKeyword;e.field=="_id"&&(i='"'+e.searchKeyword+'"'),Object.entries(M.value).forEach(([n,s])=>{n==e.field&&(s=="text"||s=="keyword")&&(i='"'+e.searchKeyword+'"'),n==e.field&&s=="long"&&(i=e.searchKeyword+"L")}),o+="."+e.searchType+'("'+e.field+'",'+i+")"}}),o=o+'.sortBy("'+h.value.sort+'","'+h.value.sortName+'")',o+=".search(10)",console.log(o),ne(o)},ne=async o=>{const e={epl:o},i=(await S.$api.tools.eplQuery(e)).hits.hits;i.forEach(s=>s._source._id=s._id);const n=i.map(s=>s._source);if(n!=null&&n.length>0){let s,d=0;for(const p of n){const _=Object.keys(p);_.length>d&&(d=_.length,s=_)}s.push("_id");const f=Object.entries(n[0]),E=[];f.forEach(([p,_])=>{_!=null&&_!==""&&E.push(p)}),s=s.filter(p=>!E.includes(p)),s.unshift(...E);const N=s.indexOf("id");if(N>-1){const[p]=s.splice(N,1);s.unshift(p)}const O=s.indexOf("_id");if(O>-1){const[p]=s.splice(O,1);s.unshift(p)}D.length=0,s.forEach(p=>{D.push({prop:p,label:p})}),console.log("\u8868\u5934"+s),console.log("\u8868\u5934:::"+JSON.stringify(D))}for(const s of n)Object.entries(s).forEach(([d,f])=>{re(f)&&(s[d]=JSON.stringify(f))});K.value=n,J.value=JSON.stringify(n,null,2)};function re(o){const e=Object.prototype.toString.call(o);return e==="[object Object]"||e==="[object Array]"}return(o,e)=>{const u=pe,i=ce,n=me,s=ye,d=fe,f=ve,E=ge,N=Ce,O=je,p=Ve,_=_e,G=be;return m(),x(w,null,[b("div",De,[(m(!0),x(w,null,T(F.value,(t,Q)=>(m(),j(f,{key:Q,style:{width:"100%","margin-bottom":"5px"},class:"custom-margin"},{default:a(()=>[l(n,{span:3},{default:a(()=>[l(i,{modelValue:t.mustType,"onUpdate:modelValue":c=>t.mustType=c,placeholder:"\u8BF7\u9009\u62E9"},{default:a(()=>[l(u,{label:"must",value:"must"}),l(u,{label:"should",value:"should"}),l(u,{label:"mustNot",value:"mustNot"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(n,{span:3},{default:a(()=>[l(i,{filterable:"",modelValue:t.field,"onUpdate:modelValue":c=>t.field=c,placeholder:"\u8BF7\u9009\u62E9\u5B57\u6BB5"},{default:a(()=>[l(u,{key:"_id",label:"_id",value:"_id"}),(m(!0),x(w,null,T(C(A),c=>(m(),j(u,{key:c,label:c,value:c},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(n,{span:3},{default:a(()=>[l(i,{modelValue:t.searchType,"onUpdate:modelValue":c=>t.searchType=c,placeholder:"\u8BF7\u9009\u62E9"},{default:a(()=>[l(u,{label:"terms",value:"terms"}),l(u,{label:"match",value:"match"}),l(u,{label:"wildcard",value:"wildcard"}),l(u,{label:"lt",value:"lt"}),l(u,{label:"le",value:"le"}),l(u,{label:"gt",value:"gt"}),l(u,{label:"ge",value:"ge"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(n,{span:3},{default:a(()=>[l(s,{modelValue:t.searchKeyword,"onUpdate:modelValue":c=>t.searchKeyword=c,clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(n,{span:8},{default:a(()=>[l(d,{onClick:X,type:"primary"},{default:a(()=>e[10]||(e[10]=[v("+")])),_:1}),l(d,{onClick:c=>Z(Q),type:"danger"},{default:a(()=>e[11]||(e[11]=[v("-")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),l(f,{style:{display:"flex","justify-content":"end","margin-top":"-0px","margin-right":"40px","flex-direction":"row"}},{default:a(()=>[l(n,{span:2},{default:a(()=>[l(d,{type:"primary",plain:"",onClick:W},{default:a(()=>e[12]||(e[12]=[v("JSON/\u8868\u683C")])),_:1})]),_:1}),l(n,{span:3},{default:a(()=>[l(i,{filterable:"",modelValue:h.value.sortName,"onUpdate:modelValue":e[0]||(e[0]=t=>h.value.sortName=t),placeholder:"\u8BF7\u9009\u62E9\u5B57\u6BB5"},{default:a(()=>[(m(!0),x(w,null,T(C(A),t=>(m(),j(u,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(n,{span:2},{default:a(()=>[l(i,{modelValue:h.value.sort,"onUpdate:modelValue":e[1]||(e[1]=t=>h.value.sort=t),placeholder:"\u8BF7\u9009\u62E9"},{default:a(()=>[l(u,{label:"DESC",value:"DESC"}),l(u,{label:"ASC",value:"ASC"})]),_:1},8,["modelValue"])]),_:1}),l(d,{onClick:H,plain:"",type:"primary"},{default:a(()=>e[13]||(e[13]=[v(" \u67E5\u8BE2 ")])),_:1})]),_:1})]),b("div",Ne,[b("div",Oe,[l(N,{width:"250px"},{default:a(()=>[l(E,null,{default:a(()=>[(m(!0),x(w,null,T(Y.value,t=>(m(),x("p",{key:t,class:"scrollbar-demo-item",onClick:Q=>oe(t),style:ke({background:y.value===t?"#84BEFC":"var(--el-color-primary-light-9)"})},Be(t),13,Ue))),128))]),_:1})]),_:1}),xe(b("div",Ie,[l(f,{gutter:10},{default:a(()=>[l(p,{onCellDblclick:ee,data:K.value,style:{"max-width":"1200px","max-height":"1000px","min-height":"100px"},size:"large"},{default:a(()=>[(m(!0),x(w,null,T(C(D),t=>(m(),j(O,{key:t.prop,label:t.label,prop:t.prop,width:"180"},null,8,["label","prop"]))),128))]),_:1},8,["data"])]),_:1}),l(f,{class:"row-bg",justify:"end"},{default:a(()=>[l(n,{span:1},{default:a(()=>[l(d,{type:"primary",plain:"",onClick:q},{default:a(()=>e[14]||(e[14]=[v("\u65B0\u589E")])),_:1})]),_:1})]),_:1})],512),[[he,K.value.length>0&&B.value=="table"]]),B.value=="json"?(m(),j(_,{key:0,class:"box-card"},{default:a(()=>[b("div",Ke,[l(R,{value:J.value,"onUpdate:value":e[2]||(e[2]=t=>J.value=t),height:"600",width:"800",styles:"width: 100%",title:""},null,8,["value"]),l(f,{class:"row-bg",justify:"end"},{default:a(()=>[l(n,{span:1},{default:a(()=>[l(d,{type:"primary",plain:"",onClick:q},{default:a(()=>e[15]||(e[15]=[v("\u65B0\u589E")])),_:1})]),_:1})]),_:1})])]),_:1})):Ee("",!0)])]),b("div",Je,[l(s,{modelValue:C(g),"onUpdate:modelValue":e[3]||(e[3]=t=>$(g)?g.value=t:g=t),placeholder:"\u8BF7\u8F93\u5165\u7D22\u5F15\u540D\u79F0",style:{width:"240px","margin-top":"0px","margin-left":"-15px"},onChange:z},null,8,["modelValue"]),l(d,{type:"primary",onClick:e[4]||(e[4]=t=>z()),plain:"",style:{width:"240px","margin-top":"10px","margin-left":"-15px"}},{default:a(()=>e[16]||(e[16]=[v("\u67E5\u8BE2\u8FC7\u6EE4")])),_:1}),l(d,{type:"primary",onClick:e[5]||(e[5]=t=>te(y.value)),plain:"",style:{width:"240px","margin-top":"10px","margin-left":"-15px"}},{default:a(()=>e[17]||(e[17]=[v("\u67E5\u770B\u6620\u5C04")])),_:1})]),l(G,{modelValue:C(V),"onUpdate:modelValue":e[7]||(e[7]=t=>$(V)?V.value=t:V=t),title:"\u67E5\u770B\u6620\u5C04",style:{"max-width":"700px",position:"relative",height:"750px",transform:"translateY(-50px)"}},{default:a(()=>[b("div",null,[l(R,{value:U.value,"onUpdate:value":e[6]||(e[6]=t=>U.value=t),height:"600",styles:"width: 100%",title:"\u67E5\u770B\u6620\u5C04"},null,8,["value"])])]),_:1},8,["modelValue"]),l(G,{modelValue:C(k),"onUpdate:modelValue":e[9]||(e[9]=t=>$(k)?k.value=t:k=t),title:"\u5F53\u524D\u7D22\u5F15:"+y.value,style:{"max-width":"700px",position:"relative",height:"750px",transform:"translateY(-50px)"}},{default:a(()=>[b("div",null,[l(R,{value:I.value,"onUpdate:value":e[8]||(e[8]=t=>I.value=t),height:"600",styles:"width: 100%",title:"\u65B0\u589E\u6570\u636E\u6CE8\u610F:_id\u5FC5\u586B,\u5426\u5219\u4F1A\u81EA\u52A8\u751F\u6210id"},null,8,["value"])]),l(d,{type:"primary",onClick:le,style:{position:"absolute",right:"10px",bottom:"10px"}},{default:a(()=>e[18]||(e[18]=[v(" \u4FDD\u5B58\u6570\u636E ")])),_:1})]),_:1},8,["modelValue","title"])],64)}}});const Ge=Fe(Me,[["__scopeId","data-v-b7966bc2"]]);export{Ge as default};
